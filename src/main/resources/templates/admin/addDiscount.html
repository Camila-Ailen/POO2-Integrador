<section class="bg-white">
    <script src="https://cdn.tailwindcss.com"></script>
    <div class="py-8 px-4 mx-auto max-w-2xl lg:py-16">
        <h2 class="mb-4 text-xl font-bold text-gray-900">Agregar un nuevo Descuento</h2>
        <form action="#" method="POST" id="discountForm" th:action="@{/admin/addDiscount}" th:object="${descuento}">
            <div class="grid gap-4 sm:grid-cols-2 sm:gap-6">
                <!-- Eleccion entre producto o paquete -->
                <div class="w-full">
                    <label class="block mb-2 text-sm font-medium text-gray-900">Aplicar a</label>
                    <div class="flex items-center gap-4">
                        <div>
                            <input type="radio" name="tipoProducto" id="aplicaParaProducto" value="producto" class="peer hidden" th:field="*{tipoProducto}" checked required>
                            <label for="aplicaParaProducto" class="cursor-pointer bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg px-4 py-2 peer-checked:bg-blue-600 peer-checked:text-white">Producto</label>
                        </div>
                        <div>
                            <input type="radio" name="tipoProducto" id="aplicaParaPaquete" value="paquete" class="peer hidden" th:field="*{tipoProducto}" required>
                            <label for="aplicaParaPaquete" class="cursor-pointer bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg px-4 py-2 peer-checked:bg-blue-600 peer-checked:text-white">Paquete</label>
                        </div>
                    </div>
                </div>

                <!-- Producto o paquete asociado -->
                <div class="sm:col-span-2">
                    <label for="item" class="block mb-2 text-sm font-medium text-gray-900">Seleccionar</label>
                    <select name="productoId" id="item" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2" th:field="*{productoId}" required>
                        <option th:each="item : ${items}" th:value="${item.id}" th:text="${item.name}"></option>
                    </select>
                </div>

                <!-- Tipo de descuento -->
                <div class="w-full">
                    <label class="block mb-2 text-sm font-medium text-gray-900">Tipo de descuento</label>
                    <div class="flex items-center gap-4">
                        <div>
                            <input type="radio" name="tipoDescuento" id="descuentoFijo" value="fixed" class="peer hidden" th:field="*{tipoDescuento}" required>
                            <label for="descuentoFijo" class="cursor-pointer bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg px-4 py-2 peer-checked:bg-blue-600 peer-checked:text-white">Fijo</label>
                        </div>
                        <div>
                            <input type="radio" name="tipoDescuento" id="descuentoPorcentaje" value="percentage" class="peer hidden" th:field="*{tipoDescuento}" required>
                            <label for="descuentoPorcentaje" class="cursor-pointer bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg px-4 py-2 peer-checked:bg-blue-600 peer-checked:text-white">Porcentaje</label>
                        </div>
                    </div>
                </div>

                <!-- Valor del descuento -->
                <div class="w-full">
                    <label for="discountValue" class="block mb-2 text-sm font-medium text-gray-900">Valor del descuento</label>
                    <input type="number" name="discountValue" id="discountValue" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2" th:field="*{discountValue}" placeholder="Ingrese el valor del descuento" required min="0" step="0.01">
                    <small id="discountValueHint" class="text-gray-500 text-sm mt-1 block">Para porcentaje, ingrese un valor entre 0 y 100.</small>
                </div>
            </div>
            <button type="submit" class="bg-green-600 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2 text-center mt-4">
                Crear Descuento
            </button>
        </form>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const discountForm = document.getElementById('discountForm');
        const fixedDiscount = document.getElementById('fixedDiscount');
        const percentageDiscount = document.getElementById('percentageDiscount');
        const discountValue = document.getElementById('discountValue');

        discountForm.addEventListener('submit', (e) => {
            let errorMessage = "";

            // Validar tipo de descuento seleccionado
            if (!fixedDiscount.checked && !percentageDiscount.checked) {
                errorMessage = "Por favor, seleccione un tipo de descuento.";
            }

            // Validar valor del descuento
            if (fixedDiscount.checked && discountValue.value <= 0) {
                errorMessage = "El valor del descuento fijo debe ser mayor a 0.";
            }

            if (percentageDiscount.checked) {
                const percentage = parseFloat(discountValue.value);
                if (isNaN(percentage) || percentage <= 0 || percentage > 100) {
                    errorMessage = "El valor del descuento por porcentaje debe estar entre 0 y 100.";
                }
            }

            if (errorMessage) {
                e.preventDefault();
                alert(errorMessage);
            }
        });

        // Reiniciar valor al cambiar tipo de descuento
        fixedDiscount.addEventListener('change', () => {
            discountValue.value = '';
        });

        percentageDiscount.addEventListener('change', () => {
            discountValue.value = '';
        });
    });
</script>
